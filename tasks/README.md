# 実装タスク実行順序ガイド

## 概要

このディレクトリには、Electron + React + TypeScript による文字起こし整形アプリの実装タスクがレイヤー別に整理されています。各タスクファイルには、実装作業にそのまま渡せる粒度のチケット群が含まれています。

## タスクファイル一覧

| ファイル | 説明 | 優先度 |
|---------|------|--------|
| `architecture.md` | 全体アーキテクチャ設計 | 🔴 最優先 |
| `ipc_contracts.md` | IPC通信の型契約定義 | 🔴 最優先 |
| `error_handling.md` | エラーハンドリング基盤 | 🟡 高 |
| `persistence.md` | データ永続化（electron-store） | 🟡 高 |
| `llm_client.md` | LLM HTTP クライアント | 🟡 高 |
| `prompting.md` | プロンプト生成ロジック | 🟡 高 |
| `preload_bridge.md` | IPC ブリッジ実装 | 🟢 中 |
| `main_process.md` | Main Process 実装 | 🟢 中 |
| `renderer_ui.md` | Renderer UI 実装 | 🟢 中 |
| `testing.md` | テスト実装 | 🔵 低（後回し可） |
| `release.md` | リリース準備 | 🔵 低（後回し可） |

## 実行順序（フェーズ別）

### Phase 0: 基盤準備（必須）

**目標**: アーキテクチャ設計と型定義の確定

#### 1. アーキテクチャ設計
- **ファイル**: `architecture.md`
- **見積**: 2時間
- **依存**: なし
- **タスク**:
  - [ ] アーキテクチャドキュメントを整備する
  - [ ] セキュリティ設定を設計する

**理由**: 全体像を把握し、IPCチャネル設計の基盤とする

#### 2. IPC型契約定義
- **ファイル**: `ipc_contracts.md`
- **見積**: 5時間（型定義3h + 型ガード2h）
- **依存**: `architecture.md`
- **タスク**:
  - [ ] IPC型定義ファイルを作成する
  - [ ] IPC型ガードを実装する

**理由**: すべてのIPC通信の基盤となる型定義を確定

#### 3. エラーハンドリング基盤
- **ファイル**: `error_handling.md`
- **見積**: 2時間
- **依存**: なし（並行可能）
- **タスク**:
  - [ ] エラーハンドリングの統一インターフェースを実装する

**理由**: すべてのレイヤーで使用するエラー処理の基盤

#### 4. 永続化基盤
- **ファイル**: `persistence.md`
- **見積**: 2時間
- **依存**: なし（並行可能）
- **タスク**:
  - [ ] electron-store の初期化を実装する

**理由**: 設定値・履歴保存の基盤

---

### Phase 1: バックエンド実装（並行可能）

**目標**: Main Process と LLM クライアントの実装

#### 5. LLM クライアント実装
- **ファイル**: `llm_client.md`
- **見積**: 15時間（ベース3h + 各プロバイダー3h×3 + 適合層4h + キャッシュ2h）
- **依存**: なし（Phase 0完了後）
- **タスク**:
  - [ ] HTTP クライアントのベース実装を作成する
  - [ ] Ollama プロバイダーを実装する
  - [ ] LM Studio プロバイダーを実装する
  - [ ] llama.cpp プロバイダーを実装する
  - [ ] プロバイダー適合層を実装する
  - [ ] モデル一覧のキャッシュを実装する

**理由**: LLM操作の基盤。他の実装と並行可能

#### 6. プロンプト生成実装
- **ファイル**: `prompting.md`
- **見積**: 7時間（デフォルト2h + オプション3h + カスタム2h）
- **依存**: なし（Phase 0完了後）
- **タスク**:
  - [ ] デフォルトプロンプトテンプレートを実装する
  - [ ] オプション設定のマージを実装する
  - [ ] カスタム指示の統合を実装する
  - [ ] プロンプトのバリデーションを実装する

**理由**: LLMリクエスト生成の基盤。LLMクライアントと並行可能

#### 7. Preload Bridge 実装
- **ファイル**: `preload_bridge.md`
- **見積**: 9時間（contextBridge 3h + 型ガード2h + 型変換2h + エラー統一2h）
- **依存**: `ipc_contracts.md`, `error_handling.md`
- **タスク**:
  - [ ] contextBridge.exposeInMainWorld を実装する
  - [ ] IPC リクエストの型ガードを実装する
  - [ ] IPC レスポンスの型変換を実装する
  - [ ] エラーハンドリングを統一する

**理由**: Renderer ↔ Main の通信層。Main Process 実装前に必要

#### 8. Main Process 実装
- **ファイル**: `main_process.md`
- **見積**: 18時間（BrowserWindow 2h + IPCハンドラ 12h + メニュー2h + ライフサイクル2h）
- **依存**: `architecture.md`, `preload_bridge.md`, `ipc_contracts.md`, `llm_client.md`, `prompting.md`, `persistence.md`
- **タスク**:
  - [ ] BrowserWindow を作成・設定する
  - [ ] IPC ハンドラを実装する（モデル管理）
  - [ ] IPC ハンドラを実装する（LLM操作）
  - [ ] IPC ハンドラを実装する（クリップボード）
  - [ ] IPC ハンドラを実装する（永続化）
  - [ ] アプリケーションメニューを実装する
  - [ ] アプリケーションライフサイクルを実装する

**理由**: アプリケーションの核となる Main Process。すべての基盤が揃ってから実装

---

### Phase 2: フロントエンド実装

**目標**: React UI の実装

#### 9. Renderer UI 実装
- **ファイル**: `renderer_ui.md`
- **見積**: 18時間（モデル選択3h + 入力2h + ボタン2h + 結果カード3h + 再整形2h + 削除1h + 状態管理3h + アクセシビリティ2h）
- **依存**: `ipc_contracts.md`, `preload_bridge.md`, `persistence.md`
- **タスク**:
  - [ ] モデル選択ドロップダウンを実装する
  - [ ] 入力テキストエリアを実装する
  - [ ] 整形ボタンとオプション設定を実装する
  - [ ] 整形結果カードとコピー機能を実装する
  - [ ] 再整形機能を実装する
  - [ ] 履歴削除機能を実装する
  - [ ] 状態管理を実装する
  - [ ] アクセシビリティとキーボード操作を実装する

**理由**: ユーザーインターフェース。Main Process 実装完了後に実装

---

### Phase 3: テスト・リリース準備

**目標**: 品質保証とリリース準備

#### 10. テスト実装
- **ファイル**: `testing.md`（未作成）
- **見積**: 未定
- **依存**: すべての実装完了後
- **タスク**:
  - [ ] ユニットテストを実装する
  - [ ] 結合テストを実装する
  - [ ] E2Eテストを実装する

**理由**: 実装完了後の品質保証

#### 11. リリース準備
- **ファイル**: `release.md`（未作成）
- **見積**: 未定
- **依存**: すべての実装完了後
- **タスク**:
  - [ ] ビルド設定を整備する
  - [ ] パッケージングを実装する
  - [ ] ドキュメントを整備する

**理由**: リリース前の最終準備

---

## 推奨実行順序（時系列）

### Week 1: 基盤準備
1. ✅ `architecture.md` - アーキテクチャ設計（2h）
2. ✅ `ipc_contracts.md` - IPC型定義（5h）
3. ✅ `error_handling.md` - エラーハンドリング基盤（2h）
4. ✅ `persistence.md` - 永続化基盤（2h）

**合計**: 約11時間

### Week 2: バックエンド実装（並行作業推奨）
5. ✅ `llm_client.md` - LLMクライアント（15h）
6. ✅ `prompting.md` - プロンプト生成（7h）
7. ✅ `preload_bridge.md` - Preload Bridge（9h）
8. ✅ `main_process.md` - Main Process（18h）

**合計**: 約49時間（並行作業で短縮可能）

### Week 3: フロントエンド実装
9. ✅ `renderer_ui.md` - Renderer UI（18h）

**合計**: 約18時間

### Week 4: テスト・リリース
10. ⏳ `testing.md` - テスト実装（未定）
11. ⏳ `release.md` - リリース準備（未定）

**合計**: 未定

---

## 並行作業の推奨組み合わせ

### 並行可能なタスク
- `error_handling.md` と `persistence.md`（Phase 0）
- `llm_client.md` と `prompting.md`（Phase 1）
- `preload_bridge.md` と `llm_client.md`（Phase 1、一部依存あり）

### 順次実行が必要なタスク
- `ipc_contracts.md` → `preload_bridge.md` → `main_process.md`
- `preload_bridge.md` → `main_process.md` → `renderer_ui.md`

---

## 優先度マトリクス

| 優先度 | フェーズ | ファイル | 理由 |
|--------|---------|---------|------|
| 🔴 最優先 | Phase 0 | `architecture.md`, `ipc_contracts.md` | すべての実装の基盤 |
| 🟡 高 | Phase 0-1 | `error_handling.md`, `persistence.md`, `llm_client.md`, `prompting.md` | コア機能の実装 |
| 🟢 中 | Phase 1-2 | `preload_bridge.md`, `main_process.md`, `renderer_ui.md` | アプリケーション本体 |
| 🔵 低 | Phase 3 | `testing.md`, `release.md` | 実装完了後の作業 |

---

## チェックリスト

### Phase 0 完了条件
- [ ] アーキテクチャ図が完成している
- [ ] IPC型定義がすべて実装されている
- [ ] エラーハンドリング基盤が実装されている
- [ ] 永続化基盤が実装されている

### Phase 1 完了条件
- [ ] LLMクライアントが動作している
- [ ] プロンプト生成が動作している
- [ ] Preload Bridge が動作している
- [ ] Main Process のIPCハンドラがすべて実装されている

### Phase 2 完了条件
- [ ] UIコンポーネントがすべて実装されている
- [ ] ユーザー操作がすべて動作している
- [ ] 状態管理が動作している

### Phase 3 完了条件
- [ ] テストが実装されている
- [ ] ビルド・パッケージングが動作している
- [ ] ドキュメントが整備されている

---

## 注意事項

1. **型定義の確定**: `ipc_contracts.md` の型定義は、実装前に必ず確定させること。後から変更すると影響範囲が大きい。

2. **エラーハンドリングの統一**: `error_handling.md` の統一インターフェースを最初に実装し、すべてのレイヤーで使用すること。

3. **並行作業の調整**: 並行作業を行う場合は、依存関係を確認し、定期的に同期を取ること。

4. **テストの早期導入**: 可能な限り早期にテストを導入し、リグレッションを防ぐこと。

5. **ドキュメントの更新**: 実装中に仕様変更があった場合は、関連するタスクファイルも更新すること。

---

## 見積合計

| フェーズ | 見積時間 |
|---------|---------|
| Phase 0: 基盤準備 | 11時間 |
| Phase 1: バックエンド実装 | 49時間 |
| Phase 2: フロントエンド実装 | 18時間 |
| Phase 3: テスト・リリース | 未定 |
| **合計** | **78時間以上** |

※ 並行作業により短縮可能。実際の作業時間は個人差があります。

---

## 次のステップ

1. `architecture.md` から開始し、全体像を把握する
2. `ipc_contracts.md` で型定義を確定する
3. 基盤実装（`error_handling.md`, `persistence.md`）を並行で進める
4. バックエンド実装を並行で進める
5. フロントエンド実装を進める
6. テスト・リリース準備を行う

各タスクファイルの詳細は、各ファイルを参照してください。

